var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{d as s,r as i,X as n,av as a,j as o,S as r,ag as l,c as d,o as h,O as c,a as u,J as m,V as p,a6 as y,u as g,M as v,D as w,L as x,P as f,at as M}from"./@vue-DGApAhZE.js";import{P as b,a as z,D as C,b as V,H as j,R as k,S as P,A as S,c as G,V as H,d as A,e as L,W as I,f as E,O as W,C as B,g as O,G as _,h as N,i as D,M as F,j as R,k as U,l as q,m as T,n as X,o as J,T as K,p as Y,q as Q,r as Z,s as $,B as ee,F as te,t as se,u as ie,v as ne,w as ae,x as oe}from"./three-ChaU29DW.js";import{i as re}from"./element-plus-B0MKPQpY.js";import"./lodash-es-CUM784Py.js";import"./@vueuse-D2H9BA2s.js";import"./@element-plus-BfODRGgU.js";import"./@popperjs-DxP-MrnL.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-CUOEq7Ny.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-TzhA1irr.js";import"./@floating-ui-anUbB2i9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class le{init(e,t,s){const i={type:"PointLight",x:0,y:0,z:0,color:16777215,intensity:1e4,distance:0,decay:2,shadowWidth:1024,shadowHeight:1024,shadowNear:.5,shadowFar:1e3,lightHelper:!1,...s};let n;switch(i.type){case"PointLight":n=new b(i.color,i.intensity,i.distance,i.decay),i.lightHelper&&e.add(new z(n,10));case"AmbientLight":n=new S(i.color,i.intensity);case"SpotLight":n=new P(i.color,i.intensity);case"RectAreaLight":n=new k(i.color,i.intensity);case"HemisphereLight":n=new j(i.color,i.color,i.intensity);case"DirectionalLight":n=new C(i.color,i.intensity),i.lightHelper&&e.add(new V(n,5));default:if(n=new b(i.color,i.intensity,i.distance,i.decay),i.lightHelper){const t=new z(n,10);e.add(t)}}n.position.set(i.x,i.y,i.z),n.castShadow=!0,e.add(n),n.shadow.mapSize.width=i.shadowWidth,n.shadow.mapSize.height=i.shadowHeight,n.shadow.camera.near=i.shadowNear,n.shadow.camera.far=i.shadowFar;const a=t.addFolder(i.type);return a.close(),a.add(n,"intensity",0,1e4,1),a.add(n.position,"x",-1e3,1e3,1),a.add(n.position,"y",-1e3,1e3,1),a.add(n.position,"z",-1e3,1e3,1),n}}class de{constructor(e=new H(0,10,20)){t(this,"scene"),t(this,"camera"),t(this,"innerWidth"),t(this,"innerHeight"),t(this,"renderer"),t(this,"controls"),t(this,"clock"),t(this,"stats"),t(this,"gui"),t(this,"axesHelper",new G(150)),this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.scene=new A,this.camera=new L(75,innerWidth/innerHeight,.1,2e3),this.camera.position.copy(e),this.renderer=new I({antialias:!0}),this.renderer.setSize(this.innerWidth,this.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=E,this.scene.add(this.axesHelper),this.controls=new W(this.camera,this.renderer.domElement),this.clock=new B,this.gui=new O,this.gui.close(),window.onresize=()=>{this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.camera.aspect=this.innerWidth/this.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.innerWidth,this.innerHeight)}}gridHelper(e=1e3,t=10){var s;const i=new _(e,t);null==(s=this.scene)||s.add(i)}onResize(){this.camera.aspect=window.innerWidth/window.innerHeight}light(e={}){return(new le).init(this.scene,this.gui,e)}init(e){const t=document.querySelector(e);null==t||t.appendChild(this.renderer.domElement),this.stats=new N,null==t||t.appendChild(this.stats.dom)}plane(){var e;const t=new D(100,100),s=new F({color:65280,side:R}),i=new U(t,s);i.rotation.x=Math.PI/2,null==(e=this.scene)||e.add(i)}destroy(){var e,t,s;null==(e=this.renderer)||e.dispose(),null==(t=this.scene)||t.traverse((e=>{var t;null==(t=this.scene)||t.remove(e)})),null==(s=this.camera)||s.remove()}}var he=(e=>(e.BoxGeometry="BoxGeometry",e.ModelGlb="modelGlb",e.ModelGltf="modelGltf",e.Image="image",e.Video="video",e))(he||{});class ce{constructor(){t(this,"lines",[]),t(this,"lineMap",new Map),t(this,"current",0),t(this,"uuid","")}getCurrentMesh(){return this.lineMap.has(this.uuid)||this.lineMap.set(this.uuid,[]),this.lineMap.get(this.uuid)}addLine(){}add(e,t){this.lines.push({uuid:e,message:t}),this.current=this.lines.length-1}next(){this.current<this.lines.length-1&&this.current++}prev(){this.current>0&&this.current--}}const ue={class:"left"},me=["data-type","data-index"],pe=["data-type"],ye={class:"right"},ge={class:"message"},ve={class:"info"},we={class:"object-container"},xe=["data-index","data-uuid","data-type"],fe={class:"animation"},Me=["data-name"],be={class:"drag-container"},ze=["data-type","data-url","data-name"],Ce={key:0,class:"video-control"},Ve={class:"control-list"},je=((e,t)=>{const s=e.__vccOpts||e;for(const[i,n]of t)s[i]=n;return s})(s({__name:"Index",setup(e){const s=new ce,M=[{name:"立方体",type:he.BoxGeometry,url:""},{name:"模型glb",type:he.ModelGlb,url:"./texture/model/Soldier.glb"},{name:"模型gltf",type:he.ModelGltf,url:"./texture/model/LeePerrySmith.glb"},{name:"图片",type:he.Image,url:"./texture/images/uv_grid_opengl.jpg"},{name:"视频",type:he.Video,url:"./texture/video/sintel.mp4"}],b=i(-1);let z=0;const C=[{type:"translate",name:"移动"},{type:"scale",name:"缩放"},{type:"rotate",name:"旋转"}],V=[{type:"delete",name:"删除"},{type:"targetPosition",name:"目标位置"}],j=i(!1),k=i(-1),P=n({position:{type:"position",x:0,y:0,z:0},rotate:{type:"rotate",x:0,y:0,z:0},scale:{type:"scale",x:0,y:0,z:0},size:{type:"size",x:0,y:0,z:0}}),S=a([]),G=i(-1);let A="";const L=a([]),I=i(""),E=e=>{var t;L.length=0,(null==(t=S[e])?void 0:t.mixer)&&L.push(...S[e].mixer)},W=i(),B=i(),O={name:"",type:"BoxGeometry",url:""},_=i(!1),N=i(!1),R=i(!1);const re=new class extends de{constructor(){super(),t(this,"meshGroup",new T),t(this,"raycaster",new X),t(this,"pointer",new J),t(this,"transformControls"),t(this,"selectGroup",new T),t(this,"selectMesh"),t(this,"textureLoader",new K),t(this,"gizmo"),t(this,"mixer"),t(this,"modelList",new T),t(this,"mixerArray",[])}load(){var e;this.init("#webgl");const t=new Y(this.renderer);this.scene.background=new Q(3355443),this.scene.environment=t.fromScene(new Z,.04).texture,null==(e=this.scene)||e.add(this.meshGroup,this.selectGroup),this.transformControls=new $(this.camera,this.renderer.domElement),this.animate(),this.gridHelper(1e3,200),this.transformControls.addEventListener("dragging-changed",(e=>{this.controls.enabled=!e.value})),this.transformControls.addEventListener("dragging-changed",(e=>{e.value||this.meshInformation(this.selectMesh).then((e=>{const t=S[G.value];s.add("",{position:e.position,rotate:e.rotate,scale:e.scale,size:{x:0,y:0,z:0},name:t.name,type:t.type,url:t.url})}))})),this.transformControls.addEventListener("object-changed",(e=>{})),this.transformControls.addEventListener("change",(e=>{this.getSelectMeshInfo(),this.selectMesh})),window.addEventListener("click",(e=>{var t;this.pointer.x=e.clientX/this.innerWidth*2-1,this.pointer.y=-e.clientY/this.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const s=this.raycaster.intersectObjects(this.meshGroup.children);if(s.length){let e=s[0].object.uuid;if("SkinnedMesh"===s[0].object.type){const i=s[0].object,n=i.skeleton.bones[0];this.selectMesh=n,e=(null==(t=i.parent)?void 0:t.uuid)||"";const a=this.setSelectMeshIndex(e);this.setSelectMesh(this.meshGroup.children[a])}else this.selectMesh=s[0].object,this.setSelectMesh(this.selectMesh),this.setSelectMeshIndex(e)}}))}remove(){var e;this.selectMesh&&(this.meshGroup.remove(this.selectMesh),null==(e=this.transformControls)||e.detach(),S.splice(G.value,1),G.value=-1)}setMode(e){var t;null==(t=this.transformControls)||t.setMode(e)}addObject(e){if(e.type===he.BoxGeometry){const t=new F({color:16777215}),s=new ee(5,5,5),i=new U(s,t);i.position.set(0,2.5,0),S.push({...e,uuid:i.uuid}),this.meshGroup.add(i)}else e.type===he.ModelGlb||e.type===he.ModelGltf?this.addModel(e):e.type===he.Image?this.addImage(e):e.type===he.Video&&this.addVideo(e)}addModel(e){var t;(t=e.url,new Promise((e=>{(new q).load(t,(t=>{e(t)}))}))).then((t=>{const i=t.scene.children[0];i.scale.set(.1,.1,.1),this.createAnimationMixer(t,i.uuid).then((t=>{S.push({...e,uuid:i.uuid,mixer:[...t]})})),this.meshGroup.add(i),s.add(i.uuid,{position:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},scale:{x:0,y:0,z:0},size:{x:0,y:0,z:0},...e})}))}addImage(e){this.textureLoader.load(e.url,(t=>{const{width:s,height:i}=t.source.data,n=new D(10,10*i/s),a=new F({map:t,side:te,transparent:!0}),o=new U(n,a);this.meshGroup.add(o),S.push({...e,uuid:o.uuid})}))}addVideo(e){const t=document.createElement("video");t.src=e.url,t.crossOrigin="Anonymous",t.loop=!0,t.muted=!0,t.pause(),t.onloadeddata=()=>{const s=new se(t),{videoWidth:i,videoHeight:n}=t,a=new D(10,10*n/i),o=new F({map:s}),r=new U(a,o);this.meshGroup.add(r),S.push({...e,uuid:r.uuid})}}createAnimationMixer(e,t){return new Promise((s=>{if(e.animations.length){const i=e.scene,n=new ie(i),a=[];let o=[];e.animations.forEach((e=>{const t=n.clipAction(e);o.push(t),a.push(e.name)})),this.mixerArray.push({uuid:t,mixer:n,action:o}),s(a)}else s([])}))}playAnimation(e){this.mixerArray.forEach((t=>{t.uuid===A&&t.action.forEach(((t,s)=>{const i=t.getClip().name;i===e?(t.play(),I.value=i):t.stop()}))}))}getAnimationName(){this.mixerArray.forEach((e=>{e.uuid===A&&e.action.forEach(((e,t)=>{const s=e.getClip().name;e.isRunning()&&(I.value=s)}))}))}getSelectMeshInfo(){this.meshInformation(this.selectMesh),this.selectMesh instanceof ne?this.getMeshSize(this.selectMesh.parent):this.getMeshSize(this.selectMesh)}meshInformation(e){return new Promise((t=>{P.position.x=e.position.x,P.position.y=e.position.y,P.position.z=e.position.z,P.rotate.x=e.rotation.x,P.rotate.y=e.rotation.y,P.rotate.z=e.rotation.z,P.scale.x=e.scale.x,P.scale.y=e.scale.y,P.scale.z=e.scale.z,t({position:e.position,rotate:e.rotation,scale:e.scale})}))}getMeshSize(e){return new Promise((t=>{if(e.children.length)e.traverse((e=>{if(e instanceof U){e.geometry.computeBoundingBox();const{max:t,min:s}=e.geometry.boundingBox||{max:new H,min:new H};(new ae).setFromPoints([s,t]).getSize(new H)}}));else{e.geometry.computeBoundingBox();const{max:t,min:s}=e.geometry.boundingBox||{max:new H,min:new H};(new ae).setFromPoints([s,t]).getSize(new H)}}))}setSelectMeshIndex(e){const t=G.value=S.findIndex((t=>t.uuid===e));return E(t),A=e,I.value="",this.getAnimationName(),this.setVideoControlVisible(S[t].type),t}setSelectMesh(e){var t,s;let i;i="string"==typeof e?this.meshGroup.getObjectByProperty("uuid",e):(e.type,e),this.selectMesh=i,this.transformControls.attach(i),this.gizmo||(this.gizmo=null==(t=this.transformControls)?void 0:t.getHelper(),null==(s=this.scene)||s.add(this.gizmo)),b.value=z}moveTargetPosition(){var e,t;if(this.selectMesh){const s=new H(0,0,0).copy(this.selectMesh.position).subVectors(new H(0,10,20),this.selectMesh.position);this.camera.lookAt(0,0,0),this.camera.position.copy(s),null==(e=this.controls)||e.target.set(0,0,0),null==(t=this.controls)||t.update()}}restore(){var e;null==(e=this.transformControls)||e.reset()}setVideoControlVisible(e){e===he.Video?_.value=!0:_.value=!1}setVideoPlay(){var e;const t=null==(e=this.meshGroup.children[G.value].material.map)?void 0:e.source.data;t.paused?t.play():t.pause()}setVideoMuted(){var e;const t=null==(e=this.meshGroup.children[G.value].material.map)?void 0:e.source.data;t.muted=!t.muted,R.value=t.muted}animate(){var e,t;if(null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),oe.update(),this.renderer.render(this.scene,this.camera),this.selectMesh&&"SkinnedMesh"===this.selectMesh.type){this.selectMesh.parent.skeleton.update(),this.selectMesh.updateMatrixWorld(!0)}if(this.mixerArray.length){const e=this.clock.getDelta();this.mixerArray.forEach((t=>{t.mixer.update(e)}))}null==(t=this.stats)||t.end()}},le=e=>{const{dataset:t}=e.target;b.value=-1,"delete"===t.type?re.remove():"targetPosition"===t.type?(re.moveTargetPosition(),k.value=1!=k.value?1:-1):(re.setMode(t.type),b.value=Number(t.index),z=Number(t.index))},je=e=>{const{dataset:t}=e.target;G.value=Number(t.index),re.setSelectMesh(t.uuid),E(G.value),A=t.uuid,re.getAnimationName(),re.setVideoControlVisible(t.type)},ke=e=>{const{dataset:t}=e.target,s=t.name;re.playAnimation(s)},Pe=e=>{const{dataset:t}=e.target;O.name=t.name||"",O.type=t.type,O.url=t.url||""},Se=e=>{re.addObject(O),j.value=!0};return o((()=>{re.load()})),r((()=>{re.gui.close(),re.gui.destroy()})),(e,t)=>{const s=l("el-input");return h(),d(c,null,[u("div",{id:"webgl",ref_key:"webglRef",ref:B,onDragover:t[0]||(t[0]=p((()=>{}),["prevent"])),onDrop:Se},null,544),u("div",ue,[j.value?(h(),d("div",{key:0,class:"list",onClick:le},[(h(),d(c,null,y(C,((e,t)=>u("div",{class:w(["item",b.value==t?"active":""]),key:t,"data-type":e.type,"data-index":t},v(e.name),11,me))),64))])):m("",!0),j.value?(h(),d("div",{key:1,class:"list",onClick:le},[(h(),d(c,null,y(V,((e,t)=>u("div",{class:w(["item",k.value==t?"active":""]),key:t,"data-type":e.type},v(e.name),11,pe))),64))])):m("",!0)]),u("div",ye,[u("div",ge,[t[7]||(t[7]=u("h1",null,"对象信息",-1)),(h(!0),d(c,null,y(P,(e=>(h(),d("div",{class:"position",key:e.type},[u("div",null,v(e.type)+":",1),u("div",ve,[t[4]||(t[4]=x(" x:")),f(s,{modelValue:e.x,"onUpdate:modelValue":t=>e.x=t,type:"number",style:{width:"60px"},placeholder:"Please input",onChange:t=>{e.type}},null,8,["modelValue","onUpdate:modelValue","onChange"]),t[5]||(t[5]=x(" y:")),f(s,{modelValue:e.y,"onUpdate:modelValue":t=>e.y=t,type:"number",style:{width:"60px"},placeholder:"Please input",onChange:t=>{e.type}},null,8,["modelValue","onUpdate:modelValue","onChange"]),t[6]||(t[6]=x(" z:")),f(s,{modelValue:e.z,"onUpdate:modelValue":t=>e.z=t,type:"number",style:{width:"60px"},placeholder:"Please input",onChange:t=>{e.type}},null,8,["modelValue","onUpdate:modelValue","onChange"])])])))),128))]),u("div",we,[t[8]||(t[8]=u("h1",null,"对象",-1)),u("div",{class:"object-list",onClick:je},[(h(!0),d(c,null,y(g(S),((e,t)=>(h(),d("div",{class:w(["item",G.value===t?"active":""]),key:e.uuid,"data-index":t,"data-uuid":e.uuid,"data-type":e.type},v(e.name),11,xe)))),128))])]),u("div",fe,[t[9]||(t[9]=u("h1",null,"动画",-1)),(h(!0),d(c,null,y(g(L),((e,t)=>(h(),d("div",{class:w(["item",I.value===e?"active":""]),key:e,"data-name":e,onClick:ke},v(e),11,Me)))),128))])]),u("div",be,[u("div",{class:"mesh",ref_key:"dragRef",ref:W},[(h(),d(c,null,y(M,((e,s)=>u("div",{class:"mesh-item",key:s,"data-type":e.type,"data-url":e.url,"data-name":e.name,draggable:"true",onDragover:t[1]||(t[1]=p((()=>{}),["prevent"])),onDragstart:Pe},v(e.name),41,ze))),64))],512)]),_.value?(h(),d("div",Ce,[u("div",Ve,[u("div",{class:"item",onClick:t[2]||(t[2]=(...e)=>g(re).setVideoPlay&&g(re).setVideoPlay(...e))},v(N.value?"暂停":"播放"),1),u("div",{class:"item",onClick:t[3]||(t[3]=(...e)=>g(re).setVideoMuted&&g(re).setVideoMuted(...e))},"静音（"+v(R.value?"是":"否")+"）",1)])])):m("",!0)],64)}}}),[["__scopeId","data-v-5c9e70de"]]),ke=M(s({__name:"App",setup:e=>(e,t)=>(h(),d("div",null,[f(je)]))}));ke.use(re),ke.mount("#app");
